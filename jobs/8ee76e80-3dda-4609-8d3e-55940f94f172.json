{
  "id" : "8ee76e80-3dda-4609-8d3e-55940f94f172",
  "name" : "Floodlight Click",
  "enabled" : true,
  "tasks" : [ {
    "id" : "cef6a72e-7c00-4bd7-9105-52986eab9833",
    "ordinal" : 1,
    "taskParameters" : [ {
      "id" : "a6545d27-113c-4e29-8310-b7a3265a4f79",
      "ordinal" : 1,
      "value" : "",
      "desc" : "Login user for authentication",
      "name" : "user",
      "valueType" : 0,
      "secret" : false,
      "refId" : "4f75fa01-c582-49aa-8f20-1b48462a8b28",
      "refValue" : "johnny.appleseed",
      "created" : [ 2018, 5, 7, 13, 20, 51, 740000000 ],
      "updated" : [ 2018, 5, 7, 9, 20, 55, 890000000 ]
    }, {
      "id" : "ecdc2a32-e833-4e45-8953-d8bee5f4ae89",
      "ordinal" : 2,
      "value" : "e6yC7uSsacPGtDcM66w7ww==",
      "desc" : "Login password for authentication",
      "name" : "password",
      "valueType" : 0,
      "secret" : true,
      "refId" : "48fbf631-e014-45ee-a8eb-298ac7d1fa21",
      "refValue" : "somepassword",
      "created" : [ 2018, 5, 7, 13, 20, 51, 742000000 ],
      "updated" : [ 2018, 5, 7, 9, 20, 58, 893000000 ]
    }, {
      "id" : "45538aad-aa52-4429-9e0c-b6df9176a068",
      "ordinal" : 3,
      "value" : "file:///Users/msewell/Desktop/jm/unzipped/.*.csv",
      "desc" : "URL to file",
      "name" : "url",
      "valueType" : 0,
      "secret" : false,
      "refId" : "45c250b3-72b5-4d81-a392-6ab7c6f5709d",
      "refValue" : "ftp://someftphost/input/*.xml",
      "created" : [ 2018, 5, 7, 13, 20, 51, 743000000 ],
      "updated" : [ 2018, 5, 7, 9, 25, 2, 364000000 ]
    }, {
      "id" : "6f4cb145-70b9-42d5-bf08-6a20a05e3211",
      "ordinal" : 4,
      "value" : "FloodLightInputFiles",
      "desc" : "Key name of output file",
      "name" : "outputKey",
      "valueType" : 0,
      "secret" : false,
      "refId" : "201b77ea-8e35-4c3c-9f45-dd8afc123e10",
      "refValue" : "OutputFileKey",
      "created" : [ 2018, 5, 7, 13, 20, 51, 745000000 ],
      "updated" : [ 2018, 5, 7, 9, 32, 55, 832000000 ]
    }, {
      "id" : "164396c0-a688-40eb-a07c-412892903d74",
      "ordinal" : 5,
      "value" : "function accept(files, file) {\n\treturn true;\n}",
      "desc" : "Javascript function to filter results",
      "name" : "fileFilter",
      "valueType" : 2,
      "secret" : false,
      "refId" : "5f033806-4a10-45cc-8624-047cfc4bfb93",
      "refValue" : "function accept(files, file) {\n\treturn true;\n}",
      "created" : [ 2018, 5, 7, 13, 20, 51, 746000000 ],
      "updated" : [ 2018, 5, 7, 13, 20, 51, 746000000 ]
    } ],
    "job" : {
      "id" : "8ee76e80-3dda-4609-8d3e-55940f94f172",
      "name" : "Floodlight Click",
      "enabled" : true,
      "desc" : "",
      "status" : "READY",
      "key" : "IC-00000018",
      "readOnly" : false,
      "environment" : "Staging",
      "domain" : {
        "id" : "bd629e46-0892-4060-abe4-fc7269247405",
        "name" : "Ignition",
        "timeZone" : "America/New_York",
        "applicationURL" : "http://demo.ignitiontransform.com",
        "awsRegion" : "us-east-1",
        "environments" : [ "Staging", "Production" ],
        "updated" : [ 1970, 1, 18, 9, 19, 5, 459000000 ],
        "created" : [ 1970, 1, 18, 9, 19, 5, 459000000 ]
      },
      "version" : 63,
      "updated" : [ 2018, 5, 22, 16, 55, 3, 847000000 ],
      "created" : [ 2018, 5, 7, 13, 20, 44, 450000000 ],
      "folder" : {
        "id" : "239954aa-3da1-469c-ad11-b0f2011d61c9"
      }
    },
    "name" : "Download File to Map Task",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.DownloadFileToMapTask",
    "enabled" : true,
    "desc" : "Task used to download a file from FTP, SFTP, WebDav, S3, or Local.",
    "refId" : "84211b05-40ce-4939-874d-825b983c3bda",
    "stopOnError" : true,
    "reportOnError" : true,
    "notify" : false,
    "nodeEligible" : true,
    "interval" : 0,
    "node" : {
      "id" : "005c0eb4-1d83-41a1-8d34-1337fce0dd2f",
      "pollingFrequency" : 0
    },
    "created" : [ 2018, 5, 7, 13, 20, 51, 737000000 ],
    "updated" : [ 2018, 5, 8, 10, 23, 35, 961000000 ],
    "nodeTask" : false
  }, {
    "id" : "538b8d3a-5c9f-4f9e-9dc4-4d0d79a09ead",
    "ordinal" : 2,
    "taskParameters" : [ {
      "id" : "bbed0106-4df0-451a-9ea1-ceffc1bcc17d",
      "ordinal" : 1,
      "value" : "/**\n * Process our DTM files and create 1 file for CP\n *\n * Author: Mike Sewell\n */\nvar inDebug = dict.inDebug; \n$includeScript('global');\n\nvar parser = new com.opencsv.CSVParserBuilder()\n    .withSeparator(',')\n    .build();\n    \nvar fileMap = new java.util.LinkedHashMap();\nvar fileList = dict.get('FloodLightInputFiles');\nvar activityReader;\nvar clickReader;\nvar impressionReader;\nvar sdf = new java.text.SimpleDateFormat(\"MM-dd-yyyy HH:mm:ss:SSS\");\n\nvar config = new com.amazonaws.mws.MarketplaceWebServiceConfig();\n\nfor (var key in fileList) {\n    var tfi = fileList.get(key);\n    var fileName = tfi.originalFileName;\n    print(fileName);\n    if (fileName.contains('match_table_campaigns_')) {\n        fileMap.put('Campaigns', buildMatchMap(tfi, 1));\n    } else if (fileName.contains('match_table_ads_')) {\n        fileMap.put('Ads', buildMatchMap(tfi, 2));\n    } else if (fileName.contains('match_table_sites_')) {\n        fileMap.put('Sites', buildMatchMap(tfi, 0));\n    } else if (fileName.contains('match_table_browsers_')) {\n        fileMap.put('Browsers', buildMatchMap(tfi, 0, 1));\n    } else if (fileName.contains('match_table_activity_cats_')) {\n        fileMap.put('ActivityCategories', buildMatchMap(tfi, 3));\n    } else if (fileName.contains('_activity_')) {\n        activityReader = new com.opencsv.CSVReaderBuilder(new java.io.FileReader(tfi.localFile))\n            .withCSVParser(parser)\n            .build();\n    } else if (fileName.contains('_click_')) {\n        clickReader = new com.opencsv.CSVReaderBuilder(new java.io.FileReader(tfi.localFile))\n            .withCSVParser(parser)\n            .build();\n    } else if (fileName.contains('_impression_')) {\n        impressionReader = new com.opencsv.CSVReaderBuilder(new java.io.FileReader(tfi.localFile))\n            .withCSVParser(parser)\n            .build();\n    } else if (fileName.contains('_paid_search_')) {\n        fileMap.put('PaidSearch', buildMatchMap(tfi, 4));\n    }\n}\n\nvar outputFile = com.ignitioncommerce.transform.util.Utility.createOutFile();\nvar fileWriter = new java.io.FileWriter(outputFile);\n\n// process activities first\n\nvar line;\nvar firstRow = true;\n\nwhile ((line = activityReader.readNext()) !== null) {\n    if (firstRow) {\n        firstRow = false;\n        continue;\n    }\n    var newLine = [];\n    newLine[0] = 'Activity';\n    \n    var milliTime = new java.math.BigDecimal(line[0]).doubleValue();\n    milliTime = milliTime / 1000;\n    newLine[1] = sdf.format(new java.util.Date(milliTime));\n    newLine[2] = line[1];\n    newLine[3] = getMatchValue('Campaigns', line[3], 2);\n    newLine[4] = getMatchValue('Ads', line[4], 3);\n    newLine[5] = getMatchValue('Sites', line[7], 1);\n    newLine[6] = getMatchValue('Browsers', line[11], 1);\n    newLine[7] = ''; // Zip\n    newLine[8] = ''; // U Value\n    newLine[9] = getMatchValue('PaidSearch', line[21], 10); // Paid Keyword\n    newLine[10] = getMatchValue('PaidSearch', line[21], 6); // Paid Search Campaign\n    newLine[11] = getMatchValue('PaidSearch', line[21], 7); // Paid Search Ad Group\n    newLine[12] = getMatchValue('ActivityCategories', line[15], 5);\n    newLine[13] = line[17];\n    if (line[19] !== '') {\n        milliTime = new java.math.BigDecimal(line[19]).doubleValue();\n        milliTime = milliTime / 1000;\n        newLine[14] = sdf.format(new java.util.Date(milliTime));\n    } else {\n        newLine[14] = '';\n    }\n    newLine[15] = line[20];\n\n    writeRecord(newLine);\n}\nactivityReader.close();\n\nfirstRow = true;\n\n// now click file\n\nwhile ((line = clickReader.readNext()) !== null) {\n    if (firstRow) {\n        firstRow = false;\n        continue;\n    }\n    var newLine = [];\n    newLine[0] = 'Click';\n    \n    var milliTime = new java.math.BigDecimal(line[0]).doubleValue();\n    milliTime = milliTime / 1000;\n    newLine[1] = sdf.format(new java.util.Date(milliTime));\n    newLine[2] = line[1];\n    newLine[3] = getMatchValue('Campaigns', line[3], 2);\n    newLine[4] = getMatchValue('Ads', line[4], 3);\n    newLine[5] = getMatchValue('Sites', line[7], 1);\n    newLine[6] = getMatchValue('Browsers', line[11], 1);\n    newLine[7] = line[16];\n    newLine[8] = line[17];\n    newLine[9] = getMatchValue('PaidSearch', line[21], 10); // Paid Keyword\n    newLine[10] = getMatchValue('PaidSearch', line[21], 6); // Paid Search Campaign\n    newLine[11] = getMatchValue('PaidSearch', line[21], 7); // Paid Search Ad Group\n    newLine[12] = getMatchValue('ActivityCategories', line[15], 5); // Activity ID\n    newLine[13] = ''; // Other Data\n    newLine[14] = ''; // Interaction Time\n    newLine[15] = ''; // Conversion ID\n\n    // write our record\n    writeRecord(newLine);\n}\nclickReader.close();\n\nfirstRow = true;\n\n// lastly impression file\n\nwhile ((line = impressionReader.readNext()) !== null) {\n    if (firstRow) {\n        firstRow = false;\n        continue;\n    }\n    var newLine = [];\n    newLine[0] = 'Impression';\n    \n    var milliTime = new java.math.BigDecimal(line[0]).doubleValue();\n    milliTime = milliTime / 1000;\n    newLine[1] = sdf.format(new java.util.Date(milliTime));\n    newLine[2] = line[1];\n    newLine[3] = getMatchValue('Campaigns', line[3], 2);\n    newLine[4] = getMatchValue('Ads', line[4], 3);\n    newLine[5] = getMatchValue('Sites', line[7], 1);\n    newLine[6] = getMatchValue('Browsers', line[11], 1);\n    newLine[7] = line[16];\n    newLine[8] = ''; // U Value\n    newLine[9] = ''; // Paid Keyword\n    newLine[10] = ''; // Paid Search Campaign\n    newLine[11] = ''; // Paid Search Ad Group    \n    newLine[12] = ''; // Activity Id\n    newLine[13] = ''; // Activity ID\n    newLine[14] = ''; // Other Data\n    newLine[15] = ''; // Interaction Time\n\n    // write our record\n    writeRecord(newLine);\n}\nimpressionReader.close();\n\nfileWriter.close();\ndict.put(\"DCMFile\", outputFile);\n\nfunction writeRecord(newLine) {\n    print(newLine);\n    for (var i=0;i<newLine.length;i++) {\n        fileWriter.write(newLine[i]);\n        if (i < newLine.length-1) {\n            fileWriter.write(\",\");\n        }\n    }\n    fileWriter.write(\"\\n\");\n}\n\nfunction getMatchValue(map, idvalue, namecol) {\n    try {\n        var thisMap = fileMap.get(map);\n        if (thisMap.containsKey(idvalue)) {\n            return thisMap.get(idvalue)[namecol];\n        }\n    } catch (err) {}\n    return '';\n}\n\nfunction buildMatchMap(tfi, idcol) {\n    var map = new java.util.LinkedHashMap();\n    var reader = new com.opencsv.CSVReaderBuilder(new java.io.FileReader(tfi.localFile))\n        .withCSVParser(parser)\n        .build();\n    var line;\n    var firstRow = true;\n    while ((line = reader.readNext()) !== null) {\n        if (firstRow) {\n            firstRow = false;\n            continue;\n        }\n        map.put(line[idcol], line);\n    }\n    reader.close();\n    return map;\n}\n\n",
      "desc" : "Script to execute",
      "name" : "script",
      "valueType" : 2,
      "secret" : false,
      "refId" : "61734d1c-1ff6-4a2b-a251-00f3bd76b9ed",
      "refValue" : "/**\n * A cool script that is documented right here.\n *\n * Author: !{ScriptAuthor} \n */\nvar inDebug = dict.inDebug; \n$includeScript('global');\n",
      "created" : [ 2018, 5, 7, 13, 29, 43, 988000000 ],
      "updated" : [ 2018, 5, 22, 12, 55, 3, 836000000 ]
    } ],
    "job" : {
      "id" : "8ee76e80-3dda-4609-8d3e-55940f94f172",
      "name" : "Floodlight Click",
      "enabled" : true,
      "desc" : "",
      "status" : "READY",
      "key" : "IC-00000018",
      "readOnly" : false,
      "environment" : "Staging",
      "domain" : {
        "id" : "bd629e46-0892-4060-abe4-fc7269247405",
        "name" : "Ignition",
        "timeZone" : "America/New_York",
        "applicationURL" : "http://demo.ignitiontransform.com",
        "awsRegion" : "us-east-1",
        "environments" : [ "Staging", "Production" ],
        "updated" : [ 1970, 1, 18, 9, 19, 5, 459000000 ],
        "created" : [ 1970, 1, 18, 9, 19, 5, 459000000 ]
      },
      "version" : 63,
      "updated" : [ 2018, 5, 22, 16, 55, 3, 847000000 ],
      "created" : [ 2018, 5, 7, 13, 20, 44, 450000000 ],
      "folder" : {
        "id" : "239954aa-3da1-469c-ad11-b0f2011d61c9"
      }
    },
    "name" : "Script Task",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.ScriptTask",
    "enabled" : true,
    "desc" : "Task used to execute custom javascript.",
    "refId" : "f5d44f40-cbd4-45fa-b45f-b062e546ad0f",
    "stopOnError" : true,
    "reportOnError" : true,
    "notify" : false,
    "nodeEligible" : false,
    "interval" : 0,
    "created" : [ 2018, 5, 7, 13, 29, 43, 986000000 ],
    "updated" : [ 2018, 5, 7, 13, 29, 46, 532000000 ],
    "nodeTask" : false
  }, {
    "id" : "bd8174f2-25e8-4387-83ca-aefa0c4e5a8c",
    "ordinal" : 3,
    "taskParameters" : [ {
      "id" : "dc3ec0ee-45f8-4bb8-a42d-4e5b77b319e9",
      "ordinal" : 1,
      "value" : "",
      "desc" : "Login user for authentication",
      "name" : "user",
      "valueType" : 0,
      "secret" : false,
      "refId" : "a68a11c6-cef6-4408-85f5-4f0728e8e3c7",
      "refValue" : "johnny.appleseed",
      "created" : [ 2018, 5, 7, 15, 17, 21, 358000000 ],
      "updated" : [ 2018, 5, 7, 11, 17, 29, 26000000 ]
    }, {
      "id" : "304a3a20-8189-4660-9963-360a6dd88820",
      "ordinal" : 2,
      "value" : "e6yC7uSsacPGtDcM66w7ww==",
      "desc" : "Login password for authentication",
      "name" : "password",
      "valueType" : 0,
      "secret" : true,
      "refId" : "a34fea04-c5b1-442c-975e-1655184f32f3",
      "refValue" : "somepassword",
      "created" : [ 2018, 5, 7, 15, 17, 21, 360000000 ],
      "updated" : [ 2018, 5, 7, 11, 17, 33, 54000000 ]
    }, {
      "id" : "538d2972-8ff7-4a00-b1fc-e8d520db6f4c",
      "ordinal" : 3,
      "value" : "file:///Users/msewell/Desktop/output.csv",
      "desc" : "URL to file",
      "name" : "url",
      "valueType" : 2,
      "secret" : false,
      "refId" : "b102d706-66ce-4d8b-8944-ec8ba327b7b2",
      "refValue" : "ftp://someftphost/input/myfile.xml",
      "created" : [ 2018, 5, 7, 15, 17, 21, 361000000 ],
      "updated" : [ 2018, 5, 7, 11, 17, 54, 377000000 ]
    }, {
      "id" : "da7cb44a-2fdf-4288-865f-1a343ae2fce8",
      "ordinal" : 4,
      "value" : "DCMFile",
      "desc" : "Key name of input file",
      "name" : "inputKey",
      "valueType" : 2,
      "secret" : false,
      "refId" : "06532b8a-daf2-457c-8c65-701e9cc0ec01",
      "refValue" : "InputFileKey",
      "created" : [ 2018, 5, 7, 15, 17, 21, 363000000 ],
      "updated" : [ 2018, 5, 7, 11, 18, 25, 630000000 ]
    }, {
      "id" : "7a6a3a93-0b28-4c64-9b4e-89a0b771d051",
      "ordinal" : 5,
      "value" : "true",
      "desc" : "Should we overwrite",
      "name" : "overwrite",
      "valueType" : 0,
      "secret" : false,
      "refId" : "5fa90437-e92d-468d-8890-edf5c8a0f2bc",
      "refValue" : "true",
      "created" : [ 2018, 5, 7, 15, 17, 21, 365000000 ],
      "updated" : [ 2018, 5, 7, 15, 17, 21, 365000000 ]
    } ],
    "job" : {
      "id" : "8ee76e80-3dda-4609-8d3e-55940f94f172",
      "name" : "Floodlight Click",
      "enabled" : true,
      "desc" : "",
      "status" : "READY",
      "key" : "IC-00000018",
      "readOnly" : false,
      "environment" : "Staging",
      "domain" : {
        "id" : "bd629e46-0892-4060-abe4-fc7269247405",
        "name" : "Ignition",
        "timeZone" : "America/New_York",
        "applicationURL" : "http://demo.ignitiontransform.com",
        "awsRegion" : "us-east-1",
        "environments" : [ "Staging", "Production" ],
        "updated" : [ 1970, 1, 18, 9, 19, 5, 459000000 ],
        "created" : [ 1970, 1, 18, 9, 19, 5, 459000000 ]
      },
      "version" : 63,
      "updated" : [ 2018, 5, 22, 16, 55, 3, 847000000 ],
      "created" : [ 2018, 5, 7, 13, 20, 44, 450000000 ],
      "folder" : {
        "id" : "239954aa-3da1-469c-ad11-b0f2011d61c9"
      }
    },
    "name" : "Upload File from Map Task",
    "clazz" : "com.ignitioncommerce.transform.tasks.core.UploadFileFromMapTask",
    "enabled" : true,
    "desc" : "Task used to upload a file to FTP, SFTP, WebDav, S3, or Local from the map.",
    "refId" : "fb285dc7-59db-4382-b004-df6ee6147084",
    "stopOnError" : true,
    "reportOnError" : true,
    "notify" : false,
    "nodeEligible" : true,
    "interval" : 0,
    "node" : {
      "id" : "005c0eb4-1d83-41a1-8d34-1337fce0dd2f",
      "pollingFrequency" : 0
    },
    "created" : [ 2018, 5, 7, 15, 17, 21, 356000000 ],
    "updated" : [ 2018, 5, 8, 8, 34, 20, 200000000 ],
    "nodeTask" : false
  } ],
  "desc" : "",
  "status" : "READY",
  "key" : "IC-00000018",
  "readOnly" : false,
  "environment" : "Staging",
  "domain" : {
    "id" : "bd629e46-0892-4060-abe4-fc7269247405",
    "name" : "Ignition",
    "timeZone" : "America/New_York",
    "applicationURL" : "http://demo.ignitiontransform.com",
    "awsRegion" : "us-east-1",
    "environments" : [ "Staging", "Production" ],
    "updated" : [ 1970, 1, 18, 9, 19, 5, 459000000 ],
    "created" : [ 1970, 1, 18, 9, 19, 5, 459000000 ]
  },
  "version" : 63,
  "updated" : [ 2018, 5, 22, 16, 55, 3, 847000000 ],
  "created" : [ 2018, 5, 7, 13, 20, 44, 450000000 ],
  "folder" : {
    "id" : "239954aa-3da1-469c-ad11-b0f2011d61c9"
  }
}